<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Lunaria Factory｜配信者・VTuber・動画投稿者・クリエイターのコミュニティ</title>
  <meta name="description" content="Lunaria Factoryは、配信者・VTuber・動画投稿者・イラストレーター・音楽クリエイターなど発信活動を行う人のためのコミュニティです。" />
  <link rel="icon" href="images/icon.png" />
  <link rel="stylesheet" href="css/style.css" />

  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "Lunaria Factory",
    "url": "https://lunariafactory.github.io/official",
    "logo": "https://lunariafactory.github.io/official/images/icon.png",
    "sameAs": [
      "https://x.com/LunariaFactory"
    ],
    "description": "配信者・VTuber・動画投稿者・クリエイターのためのコミュニティ"
  }
  </script>
</head>

<body class="page-index">
  <div class="bg" aria-hidden="true"></div>

  <div class="wrap">

    <!-- HERO -->
    <header>
      <div class="glass hero">
        <div class="brand">
          <h1>Lunaria Factory</h1>
          <div class="sub">STREAMERS &amp; VIDEO CREATORS COMMUNITY</div>
          <div class="tagline">配信・動画投稿・創作活動を行う人のための、活動拠点。</div>
        </div>
      </div>
    </header>

    <!-- 配信予定 -->
    <section class="section">
      <h2 class="panelTitle" style="margin:0 0 10px;">配信予定</h2>
      <div id="scheduleSub" class="panelSub" style="margin:0 0 14px;">読み込み中…</div>

      <div class="glass panel">
        <div id="scheduleItems">
          <div class="item">
            <div class="plus">＋</div>
            <div class="itemText">読み込み中…</div>
          </div>
        </div>

        <div class="note">
          ※ 配信を行っていない動画投稿者も活動しています
        </div>

        <div class="panelCta">
          <a class="btn-soft" href="schedule.html">
            配信予定一覧を見る
          </a>
        </div>
      </div>
    </section>

    <!-- フッター -->
    <footer>
      <div class="foot">
        <div>© Lunaria Factory</div>

        <div class="footlinks">
          <a class="footbtn" href="https://x.com/LunariaFactory">
            公式X <span class="small">@LunariaFactory</span>
          </a>

          <a class="footbtn" href="mailto:lunariafactory@gmail.com">
            お問い合わせ <span class="small">メール</span>
          </a>
        </div>
      </div>
    </footer>

  </div>

  <script>
    const DATA_URL = "https://lunaria-schedule.lunariafactory.workers.dev/data/schedule.json";

    function esc(s) {
      return String(s ?? "").replace(/[&<>"']/g, c => ({
        "&": "&amp;",
        "<": "&lt;",
        ">": "&gt;",
        '"': "&quot;",
        "'": "&#39;"
      }[c]));
    }

    function platformLabel(p) {
      if (p === "T") return "Twitch";
      return "YouTube";
    }

    function platformIconSvg(p) {
      if (p === "T") {
        return `
          <svg class="icon" viewBox="0 0 24 24">
            <path d="M4 3h18v11l-5 5h-4l-2 2H8v-2H5V6L4 3Z" fill="#7b3cff"/>
          </svg>`;
      }
      return `
        <svg class="icon" viewBox="0 0 24 24">
          <path d="M21.6 7.2a3 3 0 0 0-2.1-2.1C17.7 4.6 12 4.6 12 4.6s-5.7 0-7.5.5A3 3 0 0 0 2.4 7.2 31.7 31.7 0 0 0 2 12a31.7 31.7 0 0 0 .4 4.8Z" fill="#ff2e2e"/>
        </svg>`;
    }

    async function loadSchedule() {
      const sub = document.getElementById("scheduleSub");
      const box = document.getElementById("scheduleItems");

      try {
        const res = await fetch(DATA_URL, { cache: "no-store" });
        if (!res.ok) throw new Error();
        const data = await res.json();

        if (!data || !data.next) {
          sub.textContent = "本日の配信はありません";
          box.innerHTML = `
            <div class="item">
              <div class="plus">＋</div>
              <div class="itemText">本日の配信はありません</div>
            </div>`;
          return;
        }

        const n = data.next;

        sub.textContent = "次の配信";

        const card = `
          <div class="lfNext">
            <div class="lfWhen">
              <div class="lfDate">${esc(n.dateText)}</div>
              <div class="lfTime">${esc(n.timeText)}</div>
            </div>

            <div class="lfMain">
              <img class="lfAvatar" src="${esc(n.who.avatar)}">
              <div class="lfText">
                <div class="lfName">${esc(n.who.name)}</div>
                <div class="lfTitle">${esc(n.title)}（${platformLabel(n.platform)}）</div>
              </div>
            </div>

            <div class="lfLink">
              <a class="iconBtn" href="${esc(n.link)}">
                ${platformIconSvg(n.platform)}
              </a>
            </div>
          </div>`;

        box.innerHTML = card;

      } catch {
        sub.textContent = "配信予定を読み込めませんでした";
      }
    }

    loadSchedule();
  </script>

</body>
</html>
