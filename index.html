<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Lunaria Factory｜配信者・VTuber・動画投稿者・クリエイターのコミュニティ</title>
<meta name="description" content="Lunaria Factoryは、配信者・VTuber・動画投稿者・イラストレーター・音楽クリエイターなど発信活動を行う人のためのコミュニティです。" />
<link rel="icon" href="images/icon.png" />
<link rel="stylesheet" href="css/style.css" />

<style>
/* ===== ホーム：次の配信（2カラム固定・低く安定） ===== */

.lfTap{
  display:block;
  color:inherit;
  text-decoration:none;
}

.lfNext{
  display:grid;
  grid-template-columns:110px 1fr auto;
  align-items:center;
  gap:14px;
  padding:14px 16px;
  border-radius:18px;
  background:rgba(255,255,255,.55);
  border:1px solid rgba(15,22,51,.08);
}

.lfWhen{
  padding:10px;
  border-radius:14px;
  background:rgba(255,255,255,.8);
  border:1px solid rgba(15,22,51,.08);
  text-align:center;
  line-height:1.1;
}

.lfDate{
  font-size:11px;
  color:rgba(15,22,51,.55);
  white-space:nowrap;
}

.lfTime{
  margin-top:4px;
  font-size:16px;
  font-weight:800;
  color:rgba(15,22,51,.9);
  white-space:nowrap;
}

.lfInfo{
  min-width:0;
}

.lfName{
  font-size:14px;
  font-weight:800;
  margin-bottom:4px;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

.lfTitle{
  font-size:13px;
  color:rgba(15,22,51,.7);
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}

.lfBtn{
  display:flex;
  align-items:center;
  justify-content:center;
}

.lfBtn .iconBtn{
  width:42px;
  height:42px;
  border-radius:14px;
}
</style>
</head>

<body class="page-index">
<div class="wrap">

<section class="section">
<div>
<h2 class="panelTitle">配信予定</h2>
<div id="scheduleSub" class="panelSub">読み込み中…</div>

<div class="glass panel">
<div id="scheduleItems">
<div class="item">
<div class="plus">＋</div>
<div class="itemText">読み込み中…</div>
</div>
</div>

<div class="note">※ 配信を行っていない動画投稿者も活動しています</div>

<div class="panelCta">
<a class="btn-soft" href="schedule.html">
配信予定一覧を見る
</a>
</div>
</div>
</div>
</section>

</div>

<script>
const DATA_URL = "https://lunaria-schedule.lunariafactory.workers.dev/data/schedule.json";

function esc(s){
return String(s??"").replace(/[&<>"']/g,c=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"}[c]));
}

function platformLabel(p){
return p==="T"?"Twitch":"YouTube";
}

function platformIconSvg(p){
if(p==="T"){
return `<svg class="icon" viewBox="0 0 24 24"><path d="M4 3h18v11l-5 5h-4l-2 2H8v-2H5V6L4 3Zm3 3v10h3v2l2-2h5l3-3V6H7Zm9 2h2v5h-2V8Zm-5 0h2v5h-2V8Z" fill="#7b3cff"/></svg>`;
}
return `<svg class="icon" viewBox="0 0 24 24"><path d="M21.6 7.2a3 3 0 0 0-2.1-2.1C17.7 4.6 12 4.6 12 4.6s-5.7 0-7.5.5A3 3 0 0 0 2.4 7.2 31.7 31.7 0 0 0 2 12a31.7 31.7 0 0 0 .4 4.8 3 3 0 0 0 2.1 2.1c1.8.5 7.5.5 7.5.5s5.7 0 7.5-.5a3 3 0 0 0 2.1-2.1A31.7 31.7 0 0 0 22 12a31.7 31.7 0 0 0-.4-4.8Z" fill="#ff2e2e"/><path d="M10.2 15.3V8.7L15.8 12l-5.6 3.3Z" fill="#fff"/></svg>`;
}

async function loadSchedule(){
const sub=document.getElementById("scheduleSub");
const box=document.getElementById("scheduleItems");

try{
const res=await fetch(DATA_URL,{cache:"no-store"});
if(!res.ok)throw new Error();
const data=await res.json();

if(!data||!data.next){
sub.textContent="本日の配信はありません";
box.innerHTML='<div class="item"><div class="plus">＋</div><div class="itemText">本日の配信はありません</div></div>';
return;
}

const n=data.next;
const whoName=n.who?.name||"Lunaria Factory";
const avatar=n.who?.avatar||"images/sample2.png";
const title=n.title||"配信";
const dateText=n.dateText||"";
const timeText=n.timeText||"";
const platform=n.platform||"Y";
const link=n.link||"";

sub.textContent="次の配信";

const card=`
<div class="lfNext">
<div class="lfWhen">
<div class="lfDate">${esc(dateText)}</div>
<div class="lfTime">${esc(timeText)}</div>
</div>

<div class="lfInfo">
<div class="lfName">${esc(whoName)}</div>
<div class="lfTitle">${esc(title)}（${esc(platformLabel(platform))}）</div>
</div>

<div class="lfBtn">
${link?`<a class="iconBtn" href="${esc(link)}">${platformIconSvg(platform)}</a>`:""}
</div>
</div>`;

box.innerHTML=link?`<a class="lfTap" href="${esc(link)}">${card}</a>`:card;

}catch{
sub.textContent="配信予定を読み込めませんでした";
box.innerHTML='<div class="item"><div class="plus">＋</div><div class="itemText">エラーが発生しました</div></div>';
}
}

loadSchedule();
</script>

</body>
</html>
