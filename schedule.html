<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>配信予定・ライブスケジュール｜Lunaria Factory</title>
  <meta name="description" content="Lunaria Factoryメンバーの配信予定・ライブスケジュール一覧です。ゲーム実況、参加型配信、雑談、コラボ配信など最新の予定を掲載しています。" />
  <link rel="icon" href="images/icon.png" />
  <link rel="stylesheet" href="css/style.css" />

  <style>
    .scheduleLoading{opacity:.8;}
    .scheduleEmpty{opacity:.85; line-height:1.6; padding:18px;}
    .row{align-items:center;}
    .topic{margin:0;}
  </style>
</head>

<body class="page-schedule">
  <div class="bg" aria-hidden="true"></div>

  <main class="wrap">
    <div class="title">
      <h1>配信予定一覧</h1>
      <p>最新の配信予定やライブ情報を掲載しています。</p>
    </div>

    <section class="panel" aria-label="配信予定一覧">
      <div class="panelHead">
        <div class="h">
          <div class="k">SCHEDULE</div>
        </div>
      </div>

      <div id="scheduleList" class="scheduleLoading" aria-live="polite">
        読み込み中…
      </div>
    </section>

    <footer>
      <div class="foot">
        <div>© Lunaria Factory</div>
        <div class="footlinks">
          <a class="footbtn" href="https://x.com/LunariaFactory" aria-label="公式Xへ">
            <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M18.7 3H21l-6.6 7.5L22 21h-6.2l-4.9-6.4L5.3 21H3l7.1-8.1L2 3h6.3l4.4 5.8L18.7 3Zm-1.1 16h1.3L7.2 4.9H5.8l11.8 14.1Z" fill="#111"/>
            </svg>
            公式X <span class="small">@LunariaFactory</span>
          </a>

          <a class="footbtn" href="mailto:lunariafactory@gmail.com" aria-label="メールで問い合わせ">
            <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M3.5 6.5h17v11h-17v-11Z" fill="none" stroke="rgba(15,22,51,.60)" stroke-width="2" stroke-linejoin="round"/>
              <path d="M4.5 7.5 12 13l7.5-5.5" fill="none" stroke="rgba(15,22,51,.60)" stroke-width="2" stroke-linejoin="round" stroke-linecap="round"/>
            </svg>
            お問い合わせ <span class="small">メール</span>
          </a>
        </div>
      </div>
    </footer>
  </main>

  <script>
  (function(){
    const DATA_URL = "data/schedule.json";
    const root = document.getElementById("scheduleList");

    const PLATFORM_LABEL = { Y: "YouTube", T: "Twitch" };

    function esc(s){
      return String(s ?? "")
        .replace(/&/g,"&amp;")
        .replace(/</g,"&lt;")
        .replace(/>/g,"&gt;")
        .replace(/"/g,"&quot;")
        .replace(/'/g,"&#039;");
    }

    function iconSvg(platform){
      if(platform === "T"){
        return `
          <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
            <path d="M4 3h18v11l-5 5h-4l-2 2H8v-2H5V6L4 3Zm3 3v10h3v2l2-2h5l3-3V6H7Zm9 2h2v5h-2V8Zm-5 0h2v5h-2V8Z" fill="#7b3cff"/>
          </svg>`;
      }
      return `
        <svg class="icon" viewBox="0 0 24 24" aria-hidden="true">
          <path d="M21.6 7.2a3 3 0 0 0-2.1-2.1C17.7 4.6 12 4.6 12 4.6s-5.7 0-7.5.5A3 3 0 0 0 2.4 7.2 31.7 31.7 0 0 0 2 12a31.7 31.7 0 0 0 .4 4.8 3 3 0 0 0 2.1 2.1c1.8.5 7.5.5 7.5.5s5.7 0 7.5-.5a3 3 0 0 0 2.1-2.1A31.7 31.7 0 0 0 22 12a31.7 31.7 0 0 0-.4-4.8Z" fill="#ff2e2e"/>
          <path d="M10.2 15.3V8.7L15.8 12l-5.6 3.3Z" fill="#fff"/>
        </svg>`;
    }

    function renderEmpty(){
      root.className = "scheduleEmpty";
      root.innerHTML = `
        現在、公開されている配信予定はありません。
        <div class="sub">予定が決まり次第、ここに追加されます。</div>
      `;
    }

    function renderRows(events){
      if(!events || !events.length){ renderEmpty(); return; }
      root.className = "";
      root.innerHTML = events.map(ev => {
        const date = esc(ev.dateText || "");
        const time = esc(ev.timeText || "");
        const title = esc(ev.title || "");
        const whoName = esc(ev.who?.name || "");
        const avatar = esc(ev.who?.avatar || "images/sample2.png");
        const link = esc(ev.link || "#");
        const label = esc(PLATFORM_LABEL[ev.platform] || "");
        return `
          <div class="row">
            <div class="when">
              <div class="date">${date}</div>
              <div class="time">${time}</div>
            </div>

            <div class="info">
              <p class="topic">${title}</p>
              <div class="who">
                <div class="avatar avatar--large"><img src="${avatar}" alt="${whoName}"></div>
                <div class="whoName">${whoName}</div>
              </div>
            </div>

            <div class="links">
              <a class="iconBtn" href="${link}" target="_blank" rel="noopener" aria-label="${label}">
                ${iconSvg(ev.platform)}
              </a>
            </div>
          </div>
        `;
      }).join("");
    }

    fetch(DATA_URL, { cache: "no-store" })
      .then(r => r.ok ? r.json() : Promise.reject(new Error("fetch failed")))
      .then(data => renderRows(data?.events || []))
      .catch(() => renderEmpty());
  })();
  </script>
</body>
</html>
